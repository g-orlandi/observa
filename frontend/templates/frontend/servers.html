{% extends "frontend/base.html" %}

{% block content %}
    <h2> Servers: view, create, edit and delete</h2>
    <table class="table table-striped">
        <thead>
            <tr>
            <th scope="col">Name</th>
            <th scope="col">Owner</th>
            <th scope="col">Description</th>
            <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            {% for p in server_list %}
            <tr>
                <td>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#editModal{{ p.id }}">
                        {{ p.name }}
                    </a>
                </td>
                <td>{{ p.user }}</td>
                <td>{{ p.description }}</td>
                <td class="pe-4" style="width: 1%; white-space: nowrap;">
                    <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal{{ p.id }}">
                        Delete
                      </button>
                    
                </td>
            </tr>
            
            <!-- Modale per modifica -->
            <div class="modal fade" id="editModal{{ p.id }}" tabindex="-1" aria-labelledby="editModalLabel{{ p.id }}" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <form method="POST" action="{% url 'frontend:server_edit' pk=p.id %}">
                    {% csrf_token %}
                    <div class="modal-header">
                      <h5 class="modal-title" id="editModalLabel{{ p.id }}">Server edit</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                    </div>
                    <div class="modal-body">
                      <input type="text" name="name" value="{{ p.name }}" class="form-control" required>
                      <textarea name="description" class="form-control mt-2">{{ p.description }}</textarea>
                    </div>
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-primary">Save</button>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Modale conferma delete -->
            <div class="modal fade" id="confirmDeleteModal{{ p.id }}" tabindex="-1" aria-labelledby="confirmDeleteLabel{{ p.id }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <form method="POST" action="{% url 'frontend:server_delete' pk=p.id %}">
                      {% csrf_token %}
                      <div class="modal-header">
                        <h5 class="modal-title" id="confirmDeleteLabel{{ p.id }}">Confirm deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to delete <strong>{{ p.name }}</strong>?
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              
            {% endfor %}
        </tbody>
    </table>

    <!-- Modale Bootstrap -->
    <div class="modal fade" id="editServerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content" id="modal-body">
            <!-- Il form sarÃ  caricato qui da HTMX -->
          </div>
        </div>
      </div>

{% endblock content %}
