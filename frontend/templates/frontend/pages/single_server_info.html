{% extends "frontend/base.html" %}
{% block content %}

<!-- Selezione server -->
<form method="post" action="{% url 'frontend:set_active_server' %}" class="d-flex align-items-center ms-2" style="white-space: nowrap;">
  {% csrf_token %}
  <label for="active-server-select" class="me-2 mb-0 small">Select active server:</label>
  <select id="active-server-select" name="server_id"
          class="form-select form-select-sm py-0 px-1"
          style="height: 30px; font-size: 0.8rem; width: 300px;"
          {% comment %} onchange="this.form.submit()" {% endcomment %}
          >
    {% for server in user.servers.all %}
      <option value="{{ server.id }}" {% if server.id == user.active_server.id %}selected{% endif %}>
        {{ server }}
      </option>
    {% endfor %}
  </select>
  <button type="submit" class="btn btn-sm btn-primary ms-2">Conferma</button>

</form>
{% if no_active_server %}
<br>
  <div class="alert alert-warning">Nessun server attivo selezionato.</div>
{% else %}
<!-- Dati principali -->
<div class="container mt-4">
  <div class="row text-center g-3">
    <h2> Actual values </h2>
    <!-- CPU Usage -->
    <div class="col-md-2">
      <div class="p-3 bg-light border rounded shadow-sm">
        <div class="text-muted text-nowrap">
          <i class="bi bi-cpu"></i> CPU Usage
        </div>
        <div class="fs-3 fw-bold">{{ inst_data.cpu_usage_perc }}%</div>
        <div class="text-success small text-nowrap">
          Live
        </div>
      </div>
    </div>

    <!-- Memory -->
    <div class="col-md-3">
      <div class="p-2 bg-light border rounded shadow-sm h-100">
        <div class="text-muted text-nowrap small">
          <i class="bi bi-memory"></i> Memory used
        </div>
        <div class="fs-6 fw-bold">
          {{ inst_data.memory_used_gb }} GB / {{ inst_data.memory_total_gb }} GB
        </div>
        <div class="text-success small text-nowrap">
          Free: {{ inst_data.memory_free_gb}} GB
        </div>
      </div>
    </div>

    <!-- Disk -->
    <div class="col-md-3">
      <div class="p-2 bg-light border rounded shadow-sm h-100">
        <div class="text-muted text-nowrap small">
          <i class="bi bi-hdd-fill"></i> Disk used
        </div>
        <div class="fs-6 fw-bold">
          {{ inst_data.disk_used_gb }} GB / {{ inst_data.disk_total_gb }} GB
        </div>
        <div class="text-success small text-nowrap">
          Free: {{ inst_data.disk_free_gb }} GB
        </div>
      </div>
    </div>

    <!-- Server Uptime -->
    <div class="col-md-2">
      <div class="p-3 bg-light border rounded shadow-sm">
        <div class="text-muted text-nowrap">
          <i class="bi bi-clock-history"></i> Uptime
        </div>
        <div class="fs-3 fw-bold">{{ inst_data.server_uptime_days }} days</div>
        <div class="text-info small text-nowrap">
          Since last boot
        </div>
      </div>
    </div>
  </div>
</div>

<hr class="mt-4 mb-3">

<!-- Intervallo temporale -->
<div class="container mb-4">
  <h2 class="text-center"> Historical values </h2>

  <form method="get"
        hx-get="{% url 'frontend:load_graphs' %}"
        hx-target="#graphs-container"
        hx-trigger="submit"
        class="row g-2 align-items-center justify-content-start">
    <div class="col-auto">
      <label for="start-date" class="col-form-label small mb-0">From:</label>
    </div>
    <div class="col-auto">
      <input type="date" id="start-date" name="start_date" class="form-control form-control-sm"
             value="{{ request.GET.start_date|default:'' }}">
    </div>
    <div class="col-auto">
      <label for="end-date" class="col-form-label small mb-0">To:</label>
    </div>
    <div class="col-auto">
      <input type="date" id="end-date" name="end_date" class="form-control form-control-sm"
             value="{{ request.GET.end_date|default:'' }}">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-sm btn-primary">Apply</button>
    </div>
  </form>
</div>

<!-- Grafici caricati dinamicamente -->
<div id="graphs-container">
  {% include "frontend/components/graphs.html" %}
</div>
{% endif %}

{% endblock content %}
